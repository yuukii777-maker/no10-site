/* ===== Stormgate 背景（軽量・クリック阻害なし・Firefox最適化） ===== */
.storm-bg{
  position: fixed; inset: 0;
  z-index: 0;                 /* 背景は最背面に */
  pointer-events: none;       /* すべてのクリックを通す */
  background: #0b0f18;
  overflow: hidden;
  contain: layout paint size; /* ペイント範囲を閉じて軽くする */
  isolation: isolate;         /* blend を背景内に閉じ込める */
}
.storm-bg::after{
  content:"";
  position:absolute; inset:-12%;
  background: radial-gradient(60% 50% at 50% 55%,
              rgba(0,0,0,.35) 0%, rgba(0,0,0,.52) 55%, rgba(0,0,0,.85) 100%);
  mix-blend-mode: multiply;
  pointer-events: none;
}

/* 各レイヤー：will-change は付けない（Firefoxの予約メモリ警告を回避） */
.storm-bg .layer{
  position:absolute; inset:0; width:100%; height:100%;
  transform: translate3d(0,0,0);   /* 合成レイヤー化だけ付ける */
  transition: opacity .25s ease;   /* opacity のみトランジション */
  backface-visibility: hidden;
}
.storm-bg .layer > .anim{
  position:absolute; inset:0; width:100%; height:100%;
  object-fit: cover;
  filter: saturate(1.05) brightness(.98);  /* 静的フィルタ（アニメしない） */
  pointer-events: none;
}
.storm-bg .gate{ mix-blend-mode: screen; }
.bolt-canvas{
  position:absolute; inset:0; width:100%; height:100%;
  mix-blend-mode: screen; pointer-events:none;
}

/* --- アニメ --- */
/* 2つのtransformアニメは競合しやすいので1本に統合（十分それっぽく動きます） */
@keyframes cloud-move {
  0%   { transform: translate(  0vw, 0vh); }
  25%  { transform: translate(-2vw, 1.8vh); }
  50%  { transform: translate(-4vw, 0vh); }
  75%  { transform: translate(-6vw, 1.8vh); }
  100% { transform: translate(-8vw, 0vh); }
}
.cloud-far{ animation: cloud-move 36s linear infinite; }

@keyframes ringPulse{
  0%,100%{ filter: drop-shadow(0 0 18px rgba(255,255,255,.22)); opacity:.98; }
  50%   { filter: drop-shadow(0 0 32px rgba(255,255,255,.40)); opacity:1;    }
}
.ring-pulse{ animation: ringPulse 4.2s ease-in-out infinite; }

@keyframes rainflow{ from{ transform: translateY(-2vh); } to{ transform: translateY(2vh); } }
.rain-flow{ animation: rainflow 3.8s linear infinite; }

/* ===== BGM トグル（最前面・押せる） ===== */
.audio-toggle{
  position: fixed; left: 18px; bottom: 18px;
  z-index: 120;               /* ヘッダーより上ならここを上げる */
  display:flex; align-items:center; gap:10px;
  padding:10px 14px; border-radius:999px; border:1px solid rgba(255,255,255,.18);
  background: rgba(16,22,38,.72); color:#e7eefc; font-weight:700;
  backdrop-filter: blur(6px);
  pointer-events: auto;       /* 重要：必ず押せるように */
}
.audio-toggle .dot{
  width:10px; height:10px; border-radius:999px;
  background: #9aa4b7; box-shadow:0 0 0 2px rgba(255,255,255,.1) inset;
}
.audio-toggle .dot[data-on="1"]{ background:#6ff; box-shadow:0 0 10px #6ff; }
.audio-toggle .label{ letter-spacing:.02em; }

/* ===== コンテンツ ===== */
.ev-page{ position:relative; z-index:1; max-width:980px; margin:24px auto 88px; padding:0 16px; }
.card{
  background: rgba(16,22,38,.72);
  border: 1px solid rgba(255,255,255,.06);
  border-radius: 16px;
  box-shadow: 0 10px 40px rgba(0,0,0,.35);
  padding: 24px;
  backdrop-filter: blur(6px);
}
.brand{ font-weight:900; letter-spacing:.03em; margin:0 0 10px; }
.cutline{ font-family:"Cinzel",serif; }
.muted{ color:#b7c0d1; line-height:1.8; }
.btn{
  display:inline-block; margin-top:12px; padding:10px 18px;
  border-radius:999px; font-weight:700; color:#0b0f18;
  background: linear-gradient(90deg,#00E0FF,#F7D372,#FF37C7);
  text-decoration:none; box-shadow:0 6px 22px rgba(255,55,199,.25);
}

/* ===== イベント一覧 ===== */
.ev-wrap{ margin-top:28px; }
.ev-list{ list-style:none; padding:0; margin:0; }
.ev-item{
  position:relative; display:grid;
  grid-template-columns: 168px 1fr;
  align-items:stretch;
  margin:18px 0;
  border:1px solid rgba(255,255,255,.14);
  border-radius:12px;
  overflow:hidden;
  backdrop-filter: blur(4px);
  background: rgba(7,12,20,.45);
}
.ev-date{
  display:flex; align-items:center; justify-content:center;
  padding:18px 12px; font-family:"Cinzel",serif; font-weight:700; color:#d1e7ff;
  border-right:1px solid rgba(255,255,255,.08);
  background: linear-gradient(180deg, rgba(0,224,255,.12), rgba(255,55,199,.04));
  letter-spacing:.06em;
}
.ev-link{ position:relative; display:block; padding:18px 64px 18px 18px; color:#e7eefc; text-decoration:none; }
.ev-text{ position:relative; z-index:1; text-shadow:0 1px 2px rgba(0,0,0,.45); }

/* 青い帯（テキスト下を走る） */
.ev-band{
  position:absolute; left:0; top:0; bottom:0; width:calc(100% - 62px);
  background: linear-gradient(90deg, rgba(0,224,255,.24), rgba(247,211,114,.18), rgba(255,55,199,.20));
  opacity:.14; transform: scaleX(0); transform-origin:left center;
  transition: transform .35s cubic-bezier(.22,.61,.36,1), opacity .35s ease;
  border-right:1px solid rgba(255,255,255,.08);
}
.ev-arrow{
  position:absolute; right:18px; top:50%; translate:0 -50%;
  width:38px; height:38px; border-radius:999px;
  border:1px solid rgba(255,255,255,.3);
  box-shadow: inset 0 0 0 2px rgba(255,255,255,.06);
}
.ev-arrow::before{
  content:""; position:absolute; inset:0;
  mask: conic-gradient(from 315deg, transparent 0 75%, #000 0) exclude,
        linear-gradient(#000 0 0) 60% 50% / 30% 2px no-repeat;
  background: linear-gradient(90deg,#00E0FF,#F7D372,#FF37C7);
  -webkit-mask-composite: xor; mask-composite: exclude;
}
.ev-item:hover .ev-band{ transform: scaleX(1); opacity:.28; }
.ev-item:hover .ev-arrow{ border-color: rgba(255,255,255,.6); }

/* モバイル */
@media (max-width: 768px){
  .ev-item{ grid-template-columns: 132px 1fr; }
  .ev-link{ padding-right:56px; }
  .storm-bg .rain{ display:none; }       /* 描画負荷を抑える */
}

/* 省モーション */
@media (prefers-reduced-motion: reduce){
  .storm-bg .layer{ transform:none !important; transition:none !important; }
  .storm-bg .layer > .anim{ animation:none !important; }
  .ev-band{ transition:none !important; }
}
